# 09 开发计划（实现版，参考 Noita/魔法工艺）

> 本文档从实现角度拆解“可玩版本”的开发任务，按里程碑组织，每个里程碑都有明确的验收标准。

## 里程碑定义
- **M0：能跑**：命令行/浏览器能启动，能清怪/掉落（✅ 已完成）
- **M1：能玩（主控）**：WASD 移动 + 鼠标瞄准 + 手动施法（✅ 已完成基础）
- **M2：有手感（施法）**：前摇/后摇、指示器、投射物速度、命中反馈完整闭环
- **M3：有读性（怪物）**：怪物具象化形象 + 攻击预警 telegraph + 受击/死亡反馈
- **M4：可迭代（配置驱动）**：表现参数与判定参数同源（Option 档位），编辑器可预览指示器并导出

---

## M1：能玩（主控角色）- ✅ 基础完成，需完善

### 已完成
- ✅ WASD 移动
- ✅ 鼠标瞄准（瞄准线显示）
- ✅ 左键手动施法（CastConfirm）

### 待完善（M1.5）
- [ ] **玩家状态机**：Idle/Move/CastWindup/CastRelease/CastRecovery/Roll/Hitstun/Death
- [ ] **翻滚机制**：Space 键翻滚，短暂无敌帧（参考 Noita）
- [ ] **资源 UI**：HP/Mana 条显示，施法失败提示（参考 Noita）
- [ ] **施法节奏**：前摇中降速、后摇中限制再次施法（参考 Noita 的充能机制）

### 验收标准
- 玩家能流畅移动、瞄准、施法
- 施法有明确的节奏感（前摇/后摇）
- UI 清晰显示资源与状态

---

## M2：有手感（施法体验）- 进行中

### M2.1 指示器系统（参考 Noita）
- [ ] **Line 指示器**：直线投射物预览（射程+宽度）
- [ ] **Cone 指示器**：扇形区域预览（角度+距离）
- [ ] **Circle 指示器**：圆形 AOE 预览（半径）
- [ ] **Dash 指示器**：突进路径预览（起点+终点）
- [ ] **指示器时机**：Windup 开始显示，Release 消失

### M2.2 投射物系统（参考 Noita）
- [ ] **真实 Travel**：投射物按速度飞行，命中才 Resolve（不是瞬间结算）
- [ ] **投射物表现**：简单几何体+轨迹，参考 Noita 的投射物视觉
- [ ] **命中反馈**：命中闪光/音效/伤害数字跳字（参考 Noita）

### M2.3 时间轴对齐（参考 Noita）
- [ ] **Windup 前摇**：显示指示器，可移动但降速
- [ ] **Release 释放**：生成投射物，播放释放音效
- [ ] **Travel 飞行**：投射物按速度移动
- [ ] **Resolve 结算**：命中判定+反馈
- [ ] **Recovery 后摇**：限制再次施法（充能时间）

### 验收标准
- 玩家能清楚看到“要打哪里”（指示器）
- 投射物有真实的飞行轨迹（不是瞬间命中）
- 命中有明确的反馈（闪光/数字/音效）

---

## M3：有读性（怪物具象化）- 待开始

### M3.1 怪物视觉（参考 Noita）
- [ ] **MeleeGrunt**：小体型红色，近战轮廓明显
- [ ] **RangedShooter**：细长带枪口方向感
- [ ] **EliteBrute**：大体型、深色/金属感、精英血条

### M3.2 攻击预警（Telegraph，参考 Noita）
- [ ] **近战预警**：抬手 0.3s + 扇形 danger 指示器
- [ ] **远程预警**：举枪 0.4s + 直线 danger 指示器 + 子弹飞行
- [ ] **精英预警**：重击 0.6s + 大圆 danger 指示器
- [ ] **预警对齐**：Telegraph 持续时间 = 判定 Windup

### M3.3 反馈系统（参考 Noita）
- [ ] **受击反馈**：闪白 80ms
- [ ] **死亡反馈**：缩放/碎裂/淡出 + 掉落弹出
- [ ] **精英死亡**：额外音效与掉落更显眼

### 验收标准
- 玩家能通过预警走位躲避
- 怪物有明显的视觉特征
- 受击/死亡反馈清晰

---

## M4：可迭代（配置驱动）- 待开始

### M4.1 表现参数补齐（参考 Noita）
- [ ] **Template/Option 补齐**：windupMs/recoveryMs/projectileSpeed/indicatorShape
- [ ] **参数来源**：表现参数与判定参数同源（Option 档位）
- [ ] **参数验证**：编译时校验表现参数合法性

### M4.2 编辑器预览（参考 Noita 的魔杖编辑）
- [ ] **指示器预览**：编辑器显示当前 Assembly 的指示器形状
- [ ] **施法体验摘要**：显示前摇/后摇/弹速/范围
- [ ] **预算可视化**：预算条显示（damage/cc/mobility/proc/perf）

### M4.3 拖拽重排（参考 Noita）
- [ ] **拖拽交互**：模块卡片可拖拽重排（替代当前的上移/下移按钮）
- [ ] **实时更新**：拖拽后立即更新 Assembly 与预览

### 验收标准
- 编辑器能预览“这个 Assembly 会是什么手感”
- 表现参数完全由配置驱动，不硬编码
- 拖拽重排体验流畅

---

## 实现优先级（建议顺序）
1. **M1.5**：完善玩家状态机与资源 UI（让操控更完整）
2. **M2.1+M2.2**：指示器+投射物 Travel（让施法有手感）
3. **M3.1+M3.2**：怪物视觉+预警（让战斗有读性）
4. **M4.1+M4.2**：配置驱动+编辑器预览（让迭代更顺畅）

---

## 技术债务与后续扩展
- **音效系统**：当前只有占位，后续需要真实音效
- **粒子系统**：当前只有简单几何体，后续需要粒子效果
- **镜头系统**：当前固定视角，后续可加镜头震动/跟随
- **存档系统**：当前只做导出，后续需要持久化 Assembly
