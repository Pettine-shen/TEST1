# 复杂度控制系统（主效果+副效果架构优化版）

## 概述

复杂度控制系统用于控制随机生成技能的复杂度，通过调整配置系数可以：
- 控制槽位数量
- 限制动作类型和数量
- 控制副效果数量和类型
- 调整复杂机制的出现概率
- 平衡技能结构的复杂度

**注意**：本系统已针对主效果+副效果架构进行优化，新增了副效果数量控制和高风险高回报副效果权重配置。

## 配置位置

配置文件：`configs/ecaRules.js` 中的 `COMPLEXITY_CONFIG`

## 配置参数说明

### 1. 整体复杂度系数

```javascript
overall: 0.75  // 整体复杂度（0.0 - 1.0）
```

- `0.0` = 最简单（最少槽位、最简单动作、最少副效果）
- `1.0` = 最复杂（最多槽位、最复杂动作、最多副效果）
- 默认值：`0.75`（中高复杂度，已从0.6提升）
- **影响**：
  - `overall > 0.7` → 最多3个副效果
  - `overall > 0.4` → 最多2个副效果
  - `overall <= 0.4` → 最多1个副效果

### 2. 槽位数量系数

```javascript
slotCount: {
  min: 0.6,  // 最小槽位数系数（相对于基础值4，已从0.5提升）
  max: 0.85, // 最大槽位数系数（相对于基础值8，已从0.7提升）
}
```

**效果**：
- `min: 0.6` → 最小槽位数 = 4 × 0.6 = 2.4 ≈ 2（实际最小为3）
- `max: 0.85` → 最大槽位数 = 8 × 0.85 = 6.8 ≈ 6-7

**调整建议**：
- 降低复杂度：减小 `min` 和 `max`（如 `min: 0.4, max: 0.6`）
- 提高复杂度：增大 `min` 和 `max`（如 `min: 0.7, max: 1.0`）

### 3. 动作数量系数

```javascript
actionCount: {
  min: 1.0,  // 最小动作数系数（相对于基础值1，已从0.8提升，确保至少1个主效果）
  max: 0.8, // 最大动作数系数（相对于基础值4，已从0.6提升）
}
```

**效果**：
- `min: 1.0` → 最小动作数 = 1 × 1.0 = 1（确保至少1个主效果动作）
- `max: 0.8` → 最大动作数 = 4 × 0.8 = 3.2 ≈ 3（允许更多额外动作，如负面效果、额外Debuff等）

**注意**：在主效果+副效果架构下，主效果动作已确定，此系数主要影响额外动作（负面效果、副效果添加的Debuff等）。

**调整建议**：
- 降低复杂度：减小 `max`（如 `max: 0.5` → 最多2个额外动作）
- 提高复杂度：增大 `max`（如 `max: 1.0` → 最多4个额外动作）

### 4. 条件数量系数

```javascript
conditionCount: {
  max: 0.7,  // 最大条件数系数（相对于基础值3，已从0.5提升）
}
```

**效果**：
- `max: 0.7` → 最大条件数 = 3 × 0.7 = 2.1 ≈ 2（允许更多条件，如资源检查、距离检查等）

**调整建议**：
- 降低复杂度：减小 `max`（如 `max: 0.3` → 最多0-1个条件）
- 提高复杂度：增大 `max`（如 `max: 1.0` → 最多3个条件）

### 5. 目标数量系数

```javascript
targetCount: {
  max: 0.9,  // 最大目标数系数（相对于基础值2，已从0.7提升）
}
```

**效果**：
- `max: 0.9` → 最大目标数 = 2 × 0.9 = 1.8 ≈ 1-2（允许更多目标选择，如多目标、范围目标等）

**调整建议**：
- 降低复杂度：减小 `max`（如 `max: 0.5` → 最多1个目标）
- 提高复杂度：增大 `max`（如 `max: 1.0` → 最多2个目标）

### 6. 时间线数量系数

```javascript
timelineCount: {
  max: 0.7,  // 最大时间线数系数（相对于基础值3，已从0.5提升）
}
```

**效果**：
- `max: 0.7` → 最大时间线数 = 3 × 0.7 = 2.1 ≈ 2（允许更多时间延迟，如延迟触发、持续效果等）

**调整建议**：
- 降低复杂度：减小 `max`（如 `max: 0.3` → 最多0-1个时间线）
- 提高复杂度：增大 `max`（如 `max: 1.0` → 最多3个时间线）

**调整建议**：
- 降低复杂度：减小 `max`（如 `max: 0.3` → 最多0-1个时间线）
- 提高复杂度：增大 `max`（如 `max: 0.8` → 最多2个时间线）

### 7. 复杂动作权重系数

```javascript
complexActionWeight: {
  beam: 0.3,           // 光束类动作权重（0.0 = 完全禁用，1.0 = 正常权重）
  hover: 0.4,          // 悬停类动作权重
  chain: 0.5,          // 连锁类动作权重
  areaDot: 0.6,        // 区域DoT权重
  summon: 0.3,         // 召唤类权重
  charge: 0.5,         // 蓄力类权重
  multiProjectile: 0.7, // 多投射物权重（散射、连发等）
}
```

**效果**：
- `0.0` = 完全禁用该类动作
- `0.3` = 该类动作出现概率降低70%
- `1.0` = 正常权重，不降低概率

**调整建议**：
- **降低复杂度**：将所有权重设为 `0.0` - `0.3`
- **中等复杂度**：权重设为 `0.4` - `0.6`（当前默认值）
- **提高复杂度**：权重设为 `0.7` - `1.0`

## 预设配置示例

### 1. 极简模式（适合新手）

```javascript
export const COMPLEXITY_CONFIG = {
  overall: 0.3,
  slotCount: { min: 0.4, max: 0.5 },
  actionCount: { min: 1.0, max: 0.5 },
  conditionCount: { max: 0.3 },
  targetCount: { max: 0.5 },
  timelineCount: { max: 0.3 },
  complexActionWeight: {
    beam: 0.0,
    hover: 0.0,
    chain: 0.0,
    areaDot: 0.0,
    summon: 0.0,
    charge: 0.0,
    multiProjectile: 0.2,
  },
};
```

**效果**：
- 槽位数：3-4个
- 动作数：1-2个
- 条件数：0-1个
- 禁用所有复杂机制

### 2. 中高复杂度（当前默认，已优化）

```javascript
export const COMPLEXITY_CONFIG = {
  overall: 0.75,  // 已从0.6提升到0.75
  slotCount: { min: 0.6, max: 0.85 },  // 已提升
  actionCount: { min: 1.0, max: 0.8 },  // 已提升
  conditionCount: { max: 0.7 },  // 已提升
  targetCount: { max: 0.9 },  // 已提升
  timelineCount: { max: 0.7 },  // 已提升
  supportModifierCount: { min: 0.3, max: 0.9 },  // 新增：副效果数量控制
  highRiskHighRewardWeight: { enabled: true, weightMultiplier: 0.6 },  // 新增：高风险高回报权重
  complexActionWeight: {
    beam: 0.5,  // 已从0.3提升
    hover: 0.6,  // 已从0.4提升
    chain: 0.7,  // 已从0.5提升
    areaDot: 0.75,  // 已从0.6提升
    summon: 0.5,  // 已从0.3提升
    charge: 0.7,  // 已从0.5提升
    multiProjectile: 0.8,  // 已从0.7提升
  },
};
```

**效果**：
- 槽位数：3-6个（更多槽位）
- 动作数：1-3个（更多额外动作）
- 条件数：0-2个（更多条件）
- 副效果数：0-3个（根据overall和supportModifierCount）
- 高风险高回报副效果：60%权重（适度出现）

### 3. 高复杂度（适合高级玩家）

```javascript
export const COMPLEXITY_CONFIG = {
  overall: 0.9,
  slotCount: { min: 0.7, max: 1.0 },
  actionCount: { min: 1.0, max: 0.9 },
  conditionCount: { max: 0.9 },
  targetCount: { max: 1.0 },
  timelineCount: { max: 0.8 },
  complexActionWeight: {
    beam: 0.8,
    hover: 0.9,
    chain: 1.0,
    areaDot: 1.0,
    summon: 0.8,
    charge: 1.0,
    multiProjectile: 1.0,
  },
};
```

## 使用方法

### 方法1：直接修改配置文件

编辑 `configs/ecaRules.js`，修改 `COMPLEXITY_CONFIG` 的值。

### 方法2：运行时动态调整（未来扩展）

可以在运行时动态调整复杂度，例如：

```javascript
import { COMPLEXITY_CONFIG } from "../configs/ecaRules.js";

// 降低复杂度
COMPLEXITY_CONFIG.overall = 0.4;
COMPLEXITY_CONFIG.complexActionWeight.beam = 0.0;

// 重新生成武器时会使用新的复杂度配置
```

## 复杂度计算逻辑（主效果+副效果架构）

1. **主效果选择**：根据权重从`CORE_SKILLS`中选择一个主效果
2. **副效果数量**：
   - 根据`overall`确定基础最大副效果数（`overall > 0.7` → 3个，`overall > 0.4` → 2个，否则1个）
   - 应用`supportModifierCount.max`系数调整实际最大数
   - 根据`supportModifierCount.min`决定是否至少选择1个副效果
3. **副效果选择**：
   - 从兼容的副效果中加权随机选择
   - 高风险高回报副效果应用`highRiskHighRewardWeight.weightMultiplier`权重倍数
4. **槽位数量**：根据 `slotCount` 系数计算实际的最小/最大槽位数（主效果+副效果+负面效果+条件+目标+时间线）
5. **动作数量**：主效果动作已确定，`actionCount`主要影响额外动作（负面效果、副效果添加的Debuff等）
6. **动作过滤**：根据 `complexActionWeight` 过滤复杂动作，权重为0的动作会被移除
7. **其他槽位**：条件、目标、时间线的数量也会根据对应系数调整

## 注意事项

1. **最小值保护**：系统会自动确保最小值不低于安全值（如动作数至少为1）
2. **权重为0**：如果某个复杂动作类型的权重为0，该类动作会被完全禁用
3. **回退机制**：如果所有动作都被过滤掉，系统会回退到基础简单动作
4. **约束规则**：复杂度调整不会影响必需的约束规则（如 OnDamaged 事件必须要有触发概率条件）

## 调整建议

- **如果技能太简单**：增大 `overall`、`max` 系数，提高复杂动作权重
- **如果技能太复杂**：减小 `overall`、`max` 系数，降低复杂动作权重
- **如果想禁用某个机制**：将对应的 `complexActionWeight` 设为 `0.0`
- **如果想突出某个机制**：将对应的 `complexActionWeight` 设为 `1.0` 或更高
