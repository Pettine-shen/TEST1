# 技能可玩性提升方案

## 1. 问题分析

### 1.1 当前问题

1. **技能差异化不足**
   - 生成的技能虽然不同，但实际玩起来感觉相似
   - 缺乏明显的"特色"和"个性"
   - 玩家难以感受到不同技能带来的不同体验

2. **策略深度不足**
   - 技能主要是简单的伤害输出
   - 缺乏需要玩家思考的策略选择
   - 没有形成"高风险高回报"、"控制 vs 输出"等策略维度

3. **反馈感不足**
   - 技能效果不够明显，玩家感受不到技能的独特之处
   - 缺乏视觉和操作上的差异化反馈
   - 技能之间的差异不够直观

4. **成长感不足**
   - 技能之间没有明显的强弱差异
   - 缺乏"发现强力组合"的乐趣
   - 没有"这个技能很强"的感知

5. **组合乐趣不足**
   - 虽然有关联性约束，但组合效果不够有趣
   - 缺乏"1+1>2"的组合惊喜
   - 玩家难以感受到组合带来的质变

## 2. 提升方案

### 2.1 技能差异化设计

#### 2.1.1 建立技能"性格"系统

为每个技能定义明确的"性格标签"，确保生成的技能有明显的特色：

```javascript
// 技能性格标签
const SKILL_PERSONALITIES = {
  aggressive: "激进型",      // 高伤害、高风险
  defensive: "防御型",      // 护盾、恢复、控制
  tactical: "战术型",       // 控制、标记、处决
  mobile: "机动型",         // 位移、快速、灵活
  area: "范围型",           // 大范围、持续伤害
  single: "单体型",         // 高单体伤害、穿透
  support: "辅助型",        // 增益、减益、召唤
  hybrid: "混合型",         // 多种效果组合
};
```

**实现方式**：
- 在生成技能时，先选择一个"性格标签"
- 根据性格标签，调整动作选项的权重
- 确保生成的技能有明显的"性格"特征

#### 2.1.2 技能强度分级

建立技能强度分级系统，让玩家能感受到"这个技能很强"：

```javascript
const SKILL_TIERS = {
  common: "普通",      // 基础效果，平衡
  rare: "稀有",        // 有特色效果，略强
  epic: "史诗",        // 强力组合，明显优势
  legendary: "传说",   // 极致组合，质变效果
};
```

**实现方式**：
- 根据技能组合的复杂度和效果强度，自动分级
- 高等级技能有更明显的视觉反馈（颜色、特效）
- 在技能描述中标注等级

### 2.2 策略深度设计

#### 2.2.1 建立策略维度

定义多个策略维度，让玩家需要在不同维度之间做选择：

```javascript
const STRATEGY_DIMENSIONS = {
  // 伤害 vs 控制
  damageVsControl: {
    damage: "纯输出",      // 高伤害，无控制
    control: "纯控制",     // 强控制，低伤害
    hybrid: "混合",        // 平衡伤害和控制
  },
  
  // 安全 vs 风险
  safetyVsRisk: {
    safe: "安全型",        // 稳定输出，低风险
    risky: "风险型",       // 高伤害，但有负面效果
  },
  
  // 单体 vs 范围
  singleVsArea: {
    single: "单体",        // 高单体伤害
    area: "范围",          // 大范围伤害
  },
  
  // 爆发 vs 持续
  burstVsSustain: {
    burst: "爆发型",       // 高瞬时伤害
    sustain: "持续型",     // 持续伤害/效果
  },
};
```

**实现方式**：
- 在生成技能时，明确技能的策略定位
- 在技能描述中体现策略特点
- 确保不同策略定位的技能有明显差异

#### 2.2.2 高风险高回报机制

强化高风险高回报机制，让玩家有"赌一把"的乐趣：

```javascript
const HIGH_RISK_HIGH_REWARD = {
  // 负面效果 + 高收益
  selfDebuff: {
    selfSlow: { damageMultiplier: 1.5 },      // 自身减速 + 50%伤害
    selfVuln: { damageMultiplier: 2.0 },       // 自身易伤 + 100%伤害
    selfRoot: { damageMultiplier: 2.5 },       // 自身定身 + 150%伤害
  },
  
  // 资源消耗 + 高收益
  resourceCost: {
    highMana: { cost: 50, damageMultiplier: 1.8 },  // 高蓝耗 + 80%伤害
    hpCost: { cost: 100, damageMultiplier: 2.2 },   // 消耗HP + 120%伤害
  },
};
```

**实现方式**：
- 提高高风险高回报组合的生成概率
- 在技能描述中明确标注风险和收益
- 确保高风险技能的收益足够明显

### 2.3 反馈感设计

#### 2.3.1 视觉差异化

为不同类型的技能添加明显的视觉差异：

```javascript
const VISUAL_STYLES = {
  aggressive: {
    color: "#ff0000",      // 红色，代表攻击性
    particle: "fire",     // 火焰粒子
    sound: "explosion",   // 爆炸音效
  },
  defensive: {
    color: "#00ff00",     // 绿色，代表防御
    particle: "shield",   // 护盾粒子
    sound: "shield",     // 护盾音效
  },
  tactical: {
    color: "#0000ff",     // 蓝色，代表战术
    particle: "ice",      // 冰霜粒子
    sound: "freeze",     // 冰冻音效
  },
};
```

**实现方式**：
- 根据技能性格，应用不同的视觉风格
- 投射物、特效、音效都要有差异化
- 让玩家一眼就能看出技能的类型

#### 2.3.2 操作差异化

不同类型的技能有不同的操作手感：

```javascript
const OPERATION_STYLES = {
  instant: {
    windup: 0,            // 无前摇
    recovery: 100,       // 短后摇
    description: "瞬发",
  },
  charge: {
    windup: 500-2000,    // 长前摇（蓄力）
    recovery: 200,       // 中等后摇
    description: "蓄力",
  },
  channel: {
    windup: 200,         // 短前摇
    recovery: 300,       // 持续施法
    description: "引导",
  },
};
```

**实现方式**：
- 根据技能类型，调整前摇、后摇、弹速等参数
- 让不同类型的技能有不同的操作节奏
- 玩家需要适应不同的操作方式

### 2.4 成长感设计

#### 2.4.1 技能强度曲线

建立技能强度曲线，让玩家能感受到"这个技能很强"：

```javascript
const SKILL_POWER_CURVE = {
  // 基础技能（1-2个动作）
  basic: {
    minDamage: 50,
    maxDamage: 100,
    description: "基础技能",
  },
  
  // 进阶技能（3-4个动作，有组合效果）
  advanced: {
    minDamage: 100,
    maxDamage: 200,
    description: "进阶技能",
  },
  
  // 高级技能（5+个动作，强力组合）
  master: {
    minDamage: 200,
    maxDamage: 500,
    description: "高级技能",
  },
};
```

**实现方式**：
- 根据技能复杂度（动作数量、组合效果），计算技能强度
- 在技能描述中标注强度等级
- 高等级技能有更明显的视觉反馈

#### 2.4.2 发现强力组合的乐趣

让玩家能发现"这个组合很强"的乐趣：

```javascript
const POWERFUL_COMBOS = {
  // 经典强力组合
  combos: [
    {
      effects: ["execute", "mark", "slow"],
      description: "标记处决流：标记敌人后减速，低血量时处决",
      power: "epic",
    },
    {
      effects: ["chain", "bounce", "pierce"],
      description: "弹跳穿透流：穿透后弹跳，连锁伤害",
      power: "epic",
    },
    {
      effects: ["beam", "hover", "slow"],
      description: "持续光束流：悬停光束持续伤害，减速控制",
      power: "legendary",
    },
  ],
};
```

**实现方式**：
- 识别强力组合，提高生成概率
- 在技能描述中标注"强力组合"
- 让玩家能感受到"这个组合很强"的惊喜

### 2.5 组合乐趣设计

#### 2.5.1 质变组合

设计"1+1>2"的质变组合：

```javascript
const QUALITATIVE_COMBOS = {
  // 质变组合：组合后产生新的效果
  combos: [
    {
      effects: ["pierce", "split"],
      newEffect: "穿透分裂",  // 穿透后分裂，范围扩大
      description: "穿透后分裂，范围伤害大幅提升",
    },
    {
      effects: ["chain", "execute"],
      newEffect: "连锁处决",   // 连锁伤害可以处决
      description: "连锁伤害可以处决低血敌人",
    },
    {
      effects: ["hover", "beam"],
      newEffect: "持续光束",   // 悬停光束持续伤害
      description: "悬停光束持续伤害，高DPS",
    },
  ],
};
```

**实现方式**：
- 识别质变组合，在技能描述中特别标注
- 确保质变组合有足够明显的效果
- 让玩家能感受到组合带来的质变

#### 2.5.2 组合多样性

确保组合的多样性，避免总是生成相同的组合：

```javascript
const COMBO_DIVERSITY = {
  // 组合类型分布
  types: [
    "damage_focus",      // 伤害专注
    "control_focus",     // 控制专注
    "mobility_focus",    // 机动专注
    "sustain_focus",     // 续航专注
    "hybrid",            // 混合型
  ],
  
  // 确保每种类型都有机会生成
  minWeight: 0.15,      // 每种类型至少15%概率
};
```

**实现方式**：
- 跟踪最近生成的组合类型
- 如果某种类型生成过多，降低其权重
- 确保组合的多样性

## 3. 实现优先级

### 3.1 第一阶段（核心）

1. **技能性格系统**
   - 实现技能性格标签
   - 根据性格调整生成权重
   - 在技能描述中体现性格

2. **策略维度**
   - 实现策略维度定义
   - 在生成时明确策略定位
   - 在技能描述中体现策略

3. **视觉差异化**
   - 为不同性格的技能添加视觉差异
   - 投射物、特效、音效差异化

### 3.2 第二阶段（增强）

1. **技能强度分级**
   - 实现强度分级系统
   - 在技能描述中标注等级
   - 高等级技能视觉反馈

2. **高风险高回报**
   - 强化高风险高回报机制
   - 提高生成概率
   - 明确标注风险和收益

3. **质变组合**
   - 识别质变组合
   - 在技能描述中特别标注
   - 确保效果明显

### 3.3 第三阶段（完善）

1. **操作差异化**
   - 根据技能类型调整操作手感
   - 不同的操作节奏

2. **组合多样性**
   - 跟踪组合类型分布
   - 确保多样性

3. **成长感**
   - 技能强度曲线
   - 发现强力组合的乐趣

## 4. 技术实现

### 4.1 技能性格系统

在 `configs/ecaRules.js` 中添加：

```javascript
export const SKILL_PERSONALITIES = {
  aggressive: {
    label: "激进型",
    actionWeights: {
      "dmg_high": 2.0,
      "crit": 1.5,
      "execute": 1.5,
      "selfDebuff": 1.2,  // 允许负面效果换取高伤害
    },
    visualStyle: {
      color: "#ff0000",
      particle: "fire",
    },
  },
  // ... 其他性格
};
```

### 4.2 策略维度

在 `engine/randomWeapon.js` 中添加：

```javascript
function selectStrategyDimension(rng) {
  const dimensions = [
    { type: "damage", weight: 0.3 },
    { type: "control", weight: 0.3 },
    { type: "hybrid", weight: 0.4 },
  ];
  return selectWeighted(dimensions, rng, d => d.weight);
}
```

### 4.3 技能强度分级

在 `engine/skillDescription.js` 中添加：

```javascript
function calculateSkillTier(template, slotOptions) {
  const complexity = calculateComplexity(template, slotOptions);
  const power = calculatePower(template, slotOptions);
  
  if (complexity >= 8 && power >= 300) return "legendary";
  if (complexity >= 5 && power >= 200) return "epic";
  if (complexity >= 3 && power >= 100) return "rare";
  return "common";
}
```

## 5. 预期效果

实施这些改进后，预期能达到：

1. **技能差异化明显**：玩家能明显感受到不同技能的不同体验
2. **策略深度提升**：玩家需要在不同策略维度之间做选择
3. **反馈感增强**：技能效果更明显，玩家能感受到技能的独特之处
4. **成长感提升**：玩家能感受到"这个技能很强"的成长感
5. **组合乐趣增加**：玩家能发现"这个组合很强"的惊喜

## 6. 后续优化

1. **玩家反馈收集**：收集玩家对不同技能的感受
2. **数据统计**：统计哪些技能组合更受欢迎
3. **平衡调整**：根据数据和反馈调整生成规则
4. **持续迭代**：不断优化可玩性
